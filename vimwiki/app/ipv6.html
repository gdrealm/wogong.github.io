<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="Stylesheet" type="text/css" href="../style.css">
<title>WoNotebook</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<!-- for SyntaxHighlighter core -->
		<script type="text/javascript" src="../scripts/shCore.js"></script>
		<link type="text/css" rel="stylesheet" href="../styles/shCore.css"/>
		<!-- for SyntaxHighlighter theme -->
		<link type="text/css" rel="stylesheet" href="../styles/shThemeMidnight.css"/>
		<!-- for SyntaxHighlighter syntax -->
		<script type="text/javascript" src="../scripts/shBrushAsm.js"></script>
		<script type="text/javascript" src="../scripts/shBrushBash.js"></script>
		<script type="text/javascript" src="../scripts/shBrushCpp.js"></script>
		<script type="text/javascript" src="../scripts/shBrushCSharp.js"></script>
		<script type="text/javascript" src="../scripts/shBrushCss.js"></script>
		<script type="text/javascript" src="../scripts/shBrushJava.js"></script>
		<script type="text/javascript" src="../scripts/shBrushJScript.js"></script>
		<script type="text/javascript" src="../scripts/shBrushLua.js"></script>
		<script type="text/javascript" src="../scripts/shBrushPerl.js"></script>
		<script type="text/javascript" src="../scripts/shBrushPhp.js"></script>
		<script type="text/javascript" src="../scripts/shBrushPython.js"></script>
		<script type="text/javascript" src="../scripts/shBrushRuby.js"></script>
		<script type="text/javascript" src="../scripts/shBrushSql.js"></script>
		<script type="text/javascript" src="../scripts/shBrushVim.js"></script>
		<script type="text/javascript" src="../scripts/shBrushXml.js"></script>
		<!-- for SyntaxHighlighter execute -->
		<script type="text/javascript">
		SyntaxHighlighter.all();
		</script>
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-30349200-1']);
		  _gaq.push(['_trackPageview']);
		  (function() {
		   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		   })();
		</script>
</head>
<body>

<ul class="nav">
<li><a href="../index.html">Wiki</a></li>             
<li><a href="../Nav.html">Navigator</a></li>             
<li><a href="../About.html">About</a></li>
</ul>
<form style="float: right;" action="http://www.google.com/search" method="get">              
<input type="text" size="30" name="q"  placeholder="Search">              
<input name="sitesearch" value="wogong.github.com" type="hidden">             
</form>

<div class="clear">
<!-- Place this tag where you want the badge to render -->
<a href="https://plus.google.com/116560009434103921581?prsrc=3" rel="publisher" style="text-decoration:none;"><img src="https://ssl.gstatic.com/images/icons/gplus-32.png" alt="" style="border:0;width:16px;height:16px;float:right;"/></a>


<h1 id="toc_1">ISATAP 接入IPV6</h1>
<h3 id="toc_1.0.1">for Ubuntu（Feodra）:</h3>
<blockquote>
$ sudo ip tunnel add sit1 mode sit remote 59.66.4.50 local yourip
$ sudo ifconfig sit1 up
$ sudo ifconfig sit1 add 2001:da8:200:900e:0:5efe:yourip/64
$ sudo ip route add ::/0 via 2001:da8:200:900e::1 metric 1
</blockquote>
<p>
note：replace “yourip” with your IP like 166.111.111.111
</p>

<ul>
<li>
北京邮电大学 isatap.bupt.edu.cn

<li>
清华大学 isatap.tsinghua.edu.cn和59.66.4.50

<li>
华中科技大学 isatap.hust.edu.cn

<li>
台湾 tb.ipv6.apol.com.tw

<li>
上海交通大学 isatap.sjtu.edu.cn

</ul>

<p>
脚本文件sit：（加上执行权限chmod 777 sit）
<pre class="brush:bash;">
#!/bin/bash
local_ip=101.36.22.24
sudo ip tunnel add sit1 mode sit remote 59.66.4.50 local $local_ip
sudo ifconfig sit1 up
sudo ifconfig sit1 add 2001:da8:200:900e:0:5efe:$local_ip/64
sudo ip route add ::/0 via 2001:da8:200:900e::1 metric 1
</pre>
对于经常更换网络环境，或者采用DHCP动态分配IP的情况，可以采用以下自动获取本机IP的脚本：（下载地址：<a href="https://docs.google.com/open?id=0BwpUrJ713Y8MYzc2NjE0YWQtMGNmYi00OTYwLTg0MTEtM2VkYjYzNDdmMWQ0）">https://docs.google.com/open?id=0BwpUrJ713Y8MYzc2NjE0YWQtMGNmYi00OTYwLTg0MTEtM2VkYjYzNDdmMWQ0）</a>
<pre class="brush:bash;">
#!/bin/bash
arg=<code>ifconfig eth0 |grep "inet addr"| cut -f 2 -d ":"|cut -f 1 -d " "</code>
local_ip=$arg
sudo ip tunnel add sit2 mode sit remote 59.66.4.50 local $local_ip
sudo ifconfig sit2 up
sudo ifconfig sit2 add 2001:da8:200:900e:0:5efe:$local_ip/64
sudo ip route add ::/0 via 2001:da8:200:900e::1 metric 1
</pre>
上述自动获取IP脚本来源（全文附下）：<a href="http://hi.baidu.com/%B3%C2%B5%C2%C7%BFdeqiang/blog/item/68f28fa409ca29fd9152eec8.html">http://hi.baidu.com/%B3%C2%B5%C2%C7%BFdeqiang/blog/item/68f28fa409ca29fd9152eec8.html</a>
</p>

<p>
获取本机ip地址地址，并保存到变量中
arg=<code>ifconfig eth0 |grep "inet addr"| cut -f 2 -d ":"|cut -f 1 -d " "</code>
ipaddr=$arg
echo $ipadd
</p>

<h4 id="toc_1.0.1.1">cut参数简介</h4>
<p>
-d用来定义分隔符，默认为tab键，
-f表示需要取得哪个字段,2表示取得以-d指定的分隔符分割的第二个字段
当然也可以通过cut取得文件中每行中特定的几个字符，例如：
cut -c3-5 /etc/passwd
就是输出/etc/passwd文件中每行的第三到第五个字符。
-c 和 －f 参数可以跟以下子参数：
N 第N个字符或字段
N- 从第一个字符或字段到文件结束
N-M 从第N个到第M个字符或字段
-M 从第一个到第M个字符或字段
</p>
<h4 id="toc_1.0.1.2">NOTE：</h4>
<ol>
<li>
由于Fedora15之后，网卡的命名规则发生了改变，对于含有多块网卡的电脑来说，上述代码中的sit0可能会出问题，比如我的无线网卡为sit0，另外一块网卡，命名为p5p1(不懂怎么得出的)，所以如果要使用上述代码，得将sit0改为p5p1，否则错误如下：

</ol>
<p>
<pre class="brush:bash;">
Command line is not complete. Try option "help"
sit1: unknown interface: 没有那个设备
<dl>
<dt>getaddrinfo: 2001:da8:200:900e:0:5efe</dt>
<dd>-2</dd>
<dt>2001:da8:200:900e:0:5efe</dt>
<dd>未知的主机</dd>
</dl>
RTNETLINK answers: No route to host
</pre>
</p>
<ol>
<li>
改变网络环境时，需要更改设置。可以这样做：
    ifconfig down sit2

</ol>
<p>
再重新运行脚本建立隧道。
</p>
<ul>
<li>
2011-12-17更新：今天不知为甚，即使执行了down的命令，还是会提示错误：
    add tunnel sit0 failed: No buffer space available

</ul>
<p>
表示十分费解。难道要重启么？当然重启是可以的，不过这不是太弱了么！！what a stupid method!!
</p>
<ul>
<li>
2011-12-19更新：显然对于我这种有线无线网络环境经常改变的人来说基本会天天碰到这个问题，重启了几次之后实在不能忍受了。ipconfig -a可以看见我设置的隧道都在，sit1，sit2，sit0（这个不是我设置的，默认就有），我猜想删除这些记录就可以了，but我不知道命令。今天无意google发现这个：ip tunnel

</ul>

<p>
<pre class="brush:bash;">
sit0: ipv6/ip  remote any  local any  ttl 64  nopmtudisc 6rd-prefix 2002::/16
sit2: ipv6/ip  remote 59.66.4.50  local 101.5.124.000  ttl inherit  6rd-prefix 2002::/16
sit1: ipv6/ip  remote 59.66.4.50  local 59.66.162.100  ttl inherit  6rd-prefix 2002::/16 
</pre>
（note：上述IP地址因隐私已经调整过）
显然我的IP地址改变之后这些不能使用了，利用ip tunnel del sit*删除无用命令。重新建立隧道，问题解决！小小满足感，thanks the forum where I learned the ip tunnel(address:<a href="http://forums.gentoo.org/viewtopic-t-883527-view-next.html?sid=3b87b8e168f6f9e472195c51b6c73841">http://forums.gentoo.org/viewtopic-t-883527-view-next.html?sid=3b87b8e168f6f9e472195c51b6c73841</a>)
在多说几句，其实现在Tsinghua的无线网是可以直接登录Ipv6的，只是这速度有点汗颜，600+的ping google，隧道才40+。所以还是继续isatap吧。
</p>

<p>
3.sit* 星号数字自定，当然不能等于0了。。 
</p>


<h3 id="toc_1.0.2">for Windows（win7）:</h3>

<p>
命令文件<a href="https://docs.google.com/leaf?id=0BwpUrJ713Y8MNGU3MTE4N2UtYWYzNS00ZDdiLWJkMjItM2FlODRkYWEzMTIx&amp;hl=en_US来自北邮人论坛，只是改为清华的IP。">https://docs.google.com/leaf?id=0BwpUrJ713Y8MNGU3MTE4N2UtYWYzNS00ZDdiLWJkMjItM2FlODRkYWEzMTIx&amp;hl=en_US来自北邮人论坛，只是改为清华的IP。</a>
以下命令全部以管理员身份运行。
或者直接一句命令：
 netsh interface ipv6 isatap set router 59.66.4.50
如果是xp系统的话，需要安装ipv6：
 netsh interface ipv6 install
 windows下的比较麻烦，不知为甚偶尔会出问题。需要勾掉本地连接中网络配置中的ipv6协议。
</p>


<ul>
<li>
2012-01-01更新：win7下经常出现的麻烦是注销或者休眠之后一般isatap都会失效，重启可以解决问题。应该和linux下的问题差不多，但是windows 的命令实在了解不多，无从下手。今天遇见同样的问题，大概看了下关于netsh命令。居然尝试成功了，但是依旧不知原因。记录如下，留待以后验证：

</ul>
<p>
使用如下命令禁用并重启isatap：
</p>
<blockquote>
netsh interface isatap set state disabled
netsh interface isatap set state default
</blockquote>
<p>
重新设置isatap。
</p>

<ul>
<li>
关于netsh：

</ul>
<p>
<a href="http://msdn.microsoft.com/zh-tw/cc740203(WS.10).aspx">http://msdn.microsoft.com/zh-tw/cc740203(WS.10).aspx</a>
<a href="http://apps.hi.baidu.com/share/detail/44274899">http://apps.hi.baidu.com/share/detail/44274899</a>
</p>

</div>

</body>

	<div class="footer">
	<p>&copy; 2012 wogong &nbsp;&nbsp; </p>
	</div>

</html>

